name: rendering

on:
  push:
    # triggered on tag pushes with tags beginning with either "v" or "dev"
    branches:
      - 'tmp'
  pull_request:
    # also triggered by pull requests on the "dev" branch
    branches:
      - 'tmp'

jobs:
  test-windows:
    runs-on: windows-latest

    env:
      CONDA_ROOT: C:\Miniconda
      MESA_GL_VERSION_OVERRIDE: 4.5
      GALLIUM_DRIVER: llvmpipe
      QT_OPENGL: desktop

    steps:

    - uses: actions/checkout@v2
      name: Checkout ttk-data

    - uses: s-weigand/setup-conda@v1

    - name: Install dependencies with conda
      shell: bash
      run: |
        conda install -c conda-forge paraview
        echo "$CONDA_ROOT/Library/bin" >> $GITHUB_PATH

    - name: Remove hosted Python
      shell: bash
      run: |
        rm -rf C:/hostedtoolcache/windows/Python

    - name: Run ttk-data states
      shell: cmd
      run: |
        set PYTHONPATH=%CONDA_ROOT%\Lib
        python -X dev tests\run.py -i states\dragon.pvsm
        dir tests
